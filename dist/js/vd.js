window._vd=window.vd,function(){"use strict";function r(e){this.submitText="正在提交中...",this.formName=void 0===e?".form":e,this.init=function(){this.addErrorStyle(!1,!0),this.checkObj(this.formName),this.addVidation()},this.baseRemoteUrl="",this.disabled=function(e){$(e).attr("disabled","disabled")},this.enabled=function(e){$(e).removeAttr("disabled")},this.arrs=[],this.vdbtnText="",this.compareEmit=function(e,r,t){var d=$(e+" [name="+r+"]");if(""!==$.trim(d.val()))for(var s=0;s<this.arrs.length;s++)if($.trim(this.arrs[s].elName)===$.trim(r)){window.addEventListener?$(d).trigger("input"):$(d).trigger("keyup");break}},this.checkObj=function(m){void 0===m&&(m=".form"),this.arrs=[];var h=this;$(m+" .vd-item").each(function(){var r,e=$(this).attr("name"),t=$(this).val(),d=$(this).attr("vd-req-msg"),s=$(this).attr("vd-pattern"),a=$(this).attr("vd-pattern-msg"),v=$(this).attr("vd-ck"),o=$(this).attr("vd-req"),i=$(this).attr("vd-ck-true")||$(this).val(),l="";void 0!==d&&""===t?l=d:void 0!==a?new RegExp(s,"i").test(t)||(l=a):l="",""!==e&&"vd-btn"!==e&&((r={}).pName=m,r.elName=e,r.errorMsg=l,r.val=t,r.el=this,r.bl=!1,void 0===o&&(r.bl=!0),void 0!==v&&(this.checked?(r.bl=!0,r.val=i):(r.bl=void 0===o,r.val=$(this).attr("vd-ck-false")||!1)),h.arrs.push(r));v=$(this).attr("vd-ck-gp"),i=$(this).attr("vd-req"),o=$(this).attr("vd-req-msg");void 0!==v&&(n=$(this).find("[type=checkbox]:checked").length,$(this).parents(".vd-box"),n<=0&&void 0!==i?(r.bl=!1,r.val=[],r.errorMsg=o):(r.val=[],$(this).find("[type=checkbox]:checked").each(function(){var e=this.getAttribute("vd-ck-true")||""||this.value||"";r.val.push(e)}),r.bl=!0,r.errorMsg=""));var n=$(this).attr("vd-rd-gp"),i=$(this).attr("vd-req"),o=$(this).attr("vd-req-msg");void 0!==n&&(n=$(this).find("[type=radio]:checked").length,$(this).parents(".vd-box"),n<=0&&void 0!==i?(r.bl=!1,r.val="",r.errorMsg=o):(r.val="",$(this).find("[type=radio]:checked").each(function(){var e=this.getAttribute("vd-ck-true")||""||this.value||"";r.val=e}),r.bl=!0,r.errorMsg=""))})},this.addVidation=function(){for(var e=0;e<this.arrs.length;e++){var r=this.arrs[e],t=r.el,d=this;window.addEventListener?$(t).on("input",r,function(e){d.checkElement(e.data,e.target,!0,!0),d.addVdBtnStyle()}):$(t).on("keyup",r,function(e){d.checkElement(e.data,e.target,!0,!0),d.addVdBtnStyle()}),null===t.getAttribute("vd-remote")&&$(t).on("change",r,function(e){d.checkElement(e.data,e.target,!0,!0),d.addVdBtnStyle()});r=$(".vd-btn",this.formName);0<r.length&&r[0].hasAttribute("value")?this.vdbtnText=r.val():this.vdbtnText=r.text()}},this.checkElement=function(r,t,e,d){var s=this,a=t.getAttribute("vd-req"),v=t.getAttribute("vd-req-msg"),o=t.getAttribute("vd-pattern"),i=t.getAttribute("vd-pattern-msg"),l=t.getAttribute("vd-remote"),n=t.getAttribute("vd-remote-msg"),m=t.getAttribute("vd-remote-length"),h=t.getAttribute("vd-compare"),c=t.getAttribute("vd-compare-msg"),b=t.getAttribute("vd-compare-emit"),u=t.getAttribute("vd-ck"),f=t.getAttribute("value")||"",C=t.getAttribute("vd-ck-true"),g=t.getAttribute("vd-ck-false"),p=t.getAttribute("vd-req-msg"),k=t.getAttribute("vd-req"),x=$(t).closest(".vd-item"),y=x.attr("vd-ck-gp"),q=$(t).closest(".vd-item"),S=q.attr("vd-rd-gp"),A=$.trim(t.value),N=$(t).parents(".vd-box");if(null!==a&&void 0===y&&void 0===S){if(""===A)return r.bl=!1,r.val=A,r.errorMsg=v,N=$(t).parents(".vd-box"),$(N).removeClass("vd-pattern vd-remote vd-compare").addClass("vd-error  "),$(N).find(".vd-req,.vd-pattern,.vd-remote,.vd-compare").removeClass("vd-error"),$(N).find(".vd-req").addClass("vd-error").text(v),$(t).addClass("vd-error"),$(N).removeClass("vd-ok "),void $(".vd-dep-btn",N).addClass("vd-error").removeClass("vd-ok");N=$(t).parents(".vd-box"),$(N).removeClass("vd-error "),$(N).find(".vd-req").removeClass("vd-error").text(""),$(t).removeClass("vd-error"),$(N).addClass("vd-ok"),$(".vd-dep-btn",N).removeClass("vd-error").addClass("vd-ok"),e&&!l&&(r.errorMsg="",r.val=A,r.bl=!0)}if(null!==b&&this.compareEmit(r.pName,b,A),null!==o&&""!==A){if(!new RegExp(o,"i").test(A))return r.errorMsg=i,r.bl=!1,r.val=A,N=$(t).parents(".vd-box"),$(N).addClass("vd-error"),$(N).find(".vd-req,.vd-pattern,.vd-remote,.vd-compare").removeClass("vd-error"),$(N).find(".vd-pattern").addClass("vd-error").text(i),$(t).addClass("vd-error"),$(N).removeClass("vd-ok"),void $(".vd-dep-btn",N).addClass("vd-error").removeClass("vd-ok");r.errorMsg="",r.val=A,r.bl=!0,N=$(t).parents(".vd-box"),$(N).removeClass("vd-error "),$(N).find(".vd-pattern").removeClass("vd-error").text(""),$(t).removeClass("vd-error"),$(N).addClass("vd-ok"),$(".vd-dep-btn",N).removeClass("vd-error").addClass("vd-ok")}else l||(r.errorMsg="",r.val=A,r.bl=!0,N=$(t).parents(".vd-box"),$(N).removeClass("vd-error "),$(N).find(".vd-pattern").removeClass("vd-error").text(""),$(t).removeClass("vd-error"),$(N).addClass("vd-ok"),$(".vd-dep-btn",N).removeClass("vd-error").addClass("vd-ok"));if(null!==h){h=$(r.pName+"  [name="+h+"]");if(A!==$(h).val())return r.bl=!1,r.val=A,r.errorMsg=c,N=$(t).parents(".vd-box"),$(N).addClass("vd-error"),$(N).find(".vd-req,.vd-pattern,.vd-remote,.vd-compare").removeClass("vd-error"),$(N).find(".vd-compare").addClass("vd-error").text(c),$(N).removeClass("vd-ok"),$(t).addClass("vd-error"),void $(".vd-dep-btn",N).addClass("vd-error").removeClass("vd-ok");r.errorMsg="",r.val=A,r.bl=!0,N=$(t).parents(".vd-box"),$(N).removeClass("vd-error vd-compare "),$(N).find(".vd-compare").removeClass("vd-error").text(""),$(t).removeClass("vd-error"),$(N).addClass("vd-ok"),$(".vd-dep-btn",N).removeClass("vd-error").addClass("vd-ok")}if(null!==l){if(A.length<(null!==m?m:0))return r.errorMsg=n,r.bl=!1,r.val=A,r.remote_bl=r.bl,N=$(t).parents(".vd-box"),$(N).addClass("vd-error "),$(N).find(".vd-req,.vd-pattern,.vd-remote,.vd-compare").removeClass("vd-error"),$(N).find(".vd-remote").addClass("vd-error").text(n),$(t).addClass("vd-error"),$(N).removeClass("vd-ok"),void $(".vd-dep-btn",N).removeClass("vd-ok").addClass("vd-error");var M,E,O=this;e?($(t).trigger("onremotebefore",[t]),M=$(t).attr("vd-remote-obj"),c=($(t).attr("vd-remote-method")||"get").toLowerCase(),m=($(t).attr("vd-remote-name")||"").toLowerCase(),E=$(t).attr("vd-remote-res")||"true",(e={})[t.name]=A,$.extend(e,s.getObjectByString(m)),"application/json"===$.ajaxSetup().contentType&&"get"!==c&&(e=JSON.stringify(e)),$.ajax({url:s.baseRemoteUrl+l+"?rand="+Math.random(),type:c,data:e,timeout:1e4,success:function(e){if(e=!!(e=M?s.getObjectPropByString(e,M):e),$(t).trigger("onremoteafter",[t,e]),"true"===E){if(!e)return O.remoteFunError(r,t,n),void O.addVdBtnStyle(t);O.remoteFunOk(r,t),O.addVdBtnStyle(t)}"false"===E&&(e?O.remoteFunError(r,t,n):O.remoteFunOk(r,t),O.addVdBtnStyle(t))},error:function(e){O.remoteFunError(r,t,n)}})):(r.bl=r.remoteVal||!1,r.bl?O.remoteFunOk(r,t):O.remoteFunError(r,t,n),O.addVdBtnStyle(t))}if(null!==u){if(!t.checked)return r.val=null!==g?g:0,r.errorMsg=p,void(null!==k?(N=$(t).parents(".vd-box"),$(N).addClass("vd-error vd-ck "),$(N).removeClass("vd-ok"),$(t).addClass("vd-error"),r.bl=!1,$(N).find(".vd-req").removeClass("vd-ok").addClass("vd-error").text(p)):(r.bl=!0,$(N).find(".vd-req").removeClass("vd-error").addClass("vd-ok").text("")));r.errorMsg="",r.val=null!==C?C:f,N=$(t).parents(".vd-box"),$(N).removeClass("vd-error  "),$(t).removeClass("vd-error"),$(N).addClass("vd-ok"),$(N).find(".vd-req").removeClass("vd-error").addClass("vd-ok").text(""),r.bl=!0}void 0!==y&&(f=x.attr("vd-ck-gp"),w=x.attr("vd-req-msg"),y=x.attr("vd-req"),void 0!==f&&(f=x.find("[type=checkbox]:checked").length,N=x.parents(".vd-box"),f<=0&&void 0!==y?(N.removeClass("vd-ok"),N.addClass("vd-error"),r.bl=!1,r.val=[],A="",r.errorMsg=w,$(N).find(".vd-req").removeClass("vd-ok").addClass("vd-error").text(w)):(r.val=[],A=[],x.find("[type=checkbox]:checked").each(function(){var e=this.getAttribute("vd-ck-true")||""||this.value||"";r.val.push(e)}),r.bl=!0,r.errorMsg="",N.removeClass("vd-error"),N.addClass("vd-ok"),$(N).find(".vd-req").removeClass("vd-error").addClass("vd-ok"))));var w=q.attr("vd-rd-gp"),A=q.attr("vd-req"),x=q.attr("vd-req-msg");void 0!==w&&(q.attr("name"),w=q.find("[type=radio]:checked").length,N=$(t).parents(".vd-box"),w<=0&&null!==A?(N.removeClass("vd-ok"),N.addClass("vd-error"),r.bl=!1,r.val="",r.errorMsg=x,$(N).find(".vd-req").removeClass("vd-ok").addClass("vd-error").text(x)):(r.val="",q.find("[type=radio]:checked").each(function(){var e=this.getAttribute("vd-ck-true")||""||this.value||"";r.val=e}),r.bl=!0,r.errorMsg="",N.removeClass("vd-error"),N.addClass("vd-ok"),$(N).find(".vd-req").removeClass("vd-error").addClass("vd-ok")))},this.isSubmit=!0,this.isSuccess=function(e,r){this.addErrorStyle(!1,!1);for(var t,d=!0,s=0;s<this.arrs.length;s++){var a=this.arrs[s];if(!1===a.bl)return"function"==typeof r&&(this.isSubmit=!0,r(a)),!1}return d&&(t=this.getNewObjs(),"function"==typeof e&&this.isSubmit&&(this.isSubmit=!1,0<(d=$(".vd-btn",this.formName)).length&&d[0].hasAttribute("value")?d.val(this.submitText):d.text(this.submitText),e(t))),!0},this.getNewObjs=function(){for(var e={},r=0;r<this.arrs.length;r++){var t=this.arrs[r];t.bl&&(e[t.elName]=t.val)}return e},this.getObj=function(e){for(var r={},t=0;t<this.arrs.length;t++)if($.trim(e)===$.trim(this.arrs[t].elName)){r=this.arrs[t];break}return r},this.addErrorStyle=function(e,r){for(var t=0;t<this.arrs.length;t++){var d=this.arrs[t],s=d.el;this.checkElement(d,s,e,r),this.addVdBtnStyle()}},this.remoteFunOk=function(e,r){e.errorMsg="",e.bl=!0,e.val=$(r).val(),e.remote_bl=e.bl,e.remoteVal=!0;e=$(r).parents(".vd-box");$(e).removeClass("vd-error "),$(e).find(".vd-remote").removeClass("vd-error").text(""),$(r).removeClass("vd-error"),$(e).addClass("vd-ok"),$(".vd-dep-btn",e).removeClass("vd-error").addClass("vd-ok")},this.remoteFunError=function(e,r,t){e.errorMsg=t,e.bl=!1,e.val=$(r).val(),e.remote_bl=e.bl,e.remoteVal=!1;e=$(r).parents(".vd-box");$(e).addClass("vd-error "),$(e).find(".vd-req,.vd-pattern,.vd-remote,.vd-compare").removeClass("vd-error"),$(e).find(".vd-remote").addClass("vd-error").text(t),$(r).addClass("vd-error"),$(e).removeClass("vd-ok"),$(".vd-dep-btn",e).removeClass("vd-ok").addClass("vd-error")},this.vdIsOk=function(){for(var e=!0,r=0;r<this.arrs.length;r++)if(!1===this.arrs[r].bl)return!1;return e},this.addVdBtnStyle=function(){var e=$(this.formName),r=$(".vd-btn",e);this.vdIsOk()?(e.removeClass("vd-error").addClass("vd-ok"),r.removeClass("vd-error").addClass("vd-ok")):(e.removeClass("vd-ok").addClass("vd-error"),r.removeClass("vd-ok").addClass("vd-error"))},this.check=function(){var e=$(r).closest(".vd-box");if(1<=arguments.length){for(var r=arguments[0]||"",t=e.find(".vd-item").attr("name")||"",d=0;d<this.arrs.length;d++){var s=this.arrs[d];if(s.elName===t){r=s.el,this.checkElement(s,r,!1,!1);break}}var a=this.getObj(t);return a&&a.bl?(e.removeClass("vd-error"),$(".vd-req",e).removeClass("vd-error"),$(".vd-pattern",e).removeClass("vd-error"),$(".vd-remote",e).removeClass("vd-error"),$(".vd-compare",e).removeClass("vd-error"),$(".vd-dep-btn ",e).removeClass("vd-error")):e.addClass("vd-ok"),void(this.vdIsOk()&&$(this.formName).find(".vd-btn").removeClass("vd-error"))}this.addErrorStyle(!1,!1),e=$(this.formName),this._valStyle(e)},this.validate=function(){this.isSuccess()},this.reset=function(){this.isSubmit=!0;var e=$(this.formName);$(".vd-item",e).each(function(e){$(this).val(""),$(this)[0].hasAttribute("vd-ck")&&$(this).val(0)}),$("[type=checkbox]",e).each(function(){$(this)[0].checked=!1}),$("[type=radio]",e).each(function(){$(this)[0].checked=!1}),this.check(),this._valStyle(e);e=$(".vd-btn",this.formName);0<e.length&&e[0].hasAttribute("value")?e.val(this.vdbtnText):e.text(this.vdbtnText)},this.disabledItem=function(){this.disabled($(this.formName).find("input")),this.disabled($(this.formName).find("select")),this.disabled($(this.formName).find("textarea"))},this._valStyle=function(e){$(".vd-box",e).removeClass("vd-error "),$(".vd-btn",e).removeClass("vd-error "),$(".vd-box",e).removeClass("vd-ok"),$(".vd-btn",e).removeClass("vd-ok"),$(".vd-req",e).removeClass("vd-error"),$(".vd-pattern",e).removeClass("vd-error"),$(".vd-remote",e).removeClass("vd-error"),$(".vd-compare",e).removeClass("vd-error"),$(".vd-dep-btn ",e).removeClass("vd-error"),this.enabled($(this.formName).find("input")),this.enabled($(this.formName).find("select")),this.enabled($(this.formName).find("textarea"))},this.getObjectPropByString=function(e,r){for(var t,d=(r=r||"").split("."),s=null,a=0,v=d.length;a<v&&void 0!==e[t=d[a]];a++)s=e[t];return s},this.getObjectByString=function(e){for(var r=(e=e||"").split(","),t={},d=0,s=r.length;d<s;d++){var a=r[d].split("=")||[],v=2<=a.length?a[1]:a[0],o=a[0],a=this.getObj(o);a&&(t[v]=a.val)}return t}}window.vd={create:function(e){return new r(e)}}}();